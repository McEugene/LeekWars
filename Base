if (getWeapon() != WEAPON_MAGNUM) {
	setWeapon(WEAPON_MAGNUM); // Warning: costs 1 TP	
}

var enemy = getNearestEnemy();

var mpsLeft = getTotalMP();
var enemyCells = getCellsToUseWeapon(enemy);

while (shouldMove(enemy) && mpsLeft > 0) {
	moveTowardCells(enemyCells, 1);
	mpsLeft = mpsLeft - 1;
}

useIfPossible(CHIP_SHIELD, shouldUseShield(enemy));
useAllWeaponIfPossible(enemy);
useOnEnemyIfPossible(CHIP_ROCK, enemy);
useIfArmed(CHIP_CURE);
useIfArmed(CHIP_BANDAGE);
useAllOnEnemyIfPossible(CHIP_SPARK, enemy);

//moveAwayFrom(enemy);

////////////
// FUNCTIONS
////////////
function shouldMove(enemy) {
	return !canUseWeapon(enemy) 
		|| !lineOfSight(getCell(), getCell(enemy));
}

function shouldUseShield(enemy) {
	return getCell(enemy) != null 
	&& getCellDistance(getCell(), getCell(enemy)) < 10 + 4
	&& getLife(enemy) > 120;
}

function isArmed(leek) {
	return getTotalLife(leek) > getLife(leek);
}	

function useIfArmed(chip) {
	if (canUseChip(chip, getLeek()) && isArmed(getLeek())) {
		useChip(chip, getLeek());
	}
}

function useIfPossible(chip, shouldUse) {
	if (shouldUse && canUseChip(chip, getLeek())) {
		useChip(chip, getLeek());
	}
}

function useOnEnemyIfPossible(chip, enemy) {
	if (canUseChip(chip, enemy)) {
		return useChip(chip, enemy);
	}
}

function useAllOnEnemyIfPossible(chip, enemy) {
	var result;
	do {
		result = useOnEnemyIfPossible(chip, enemy);
	} while (result > 0);
}

function useWeaponIfPossible(enemy){
	if (canUseWeapon(enemy)) {
		return useWeapon(enemy);
	}
}
function useAllWeaponIfPossible(enemy){
	var result;
	do {
		result = useWeaponIfPossible(enemy);
	} while (result > 0);
}
